# ALOAM_review

## lidar_process

### 模块输入：

​	激光雷达点云sensor_msg::PointCloud2

### 模块输出：

​	处理好的有序点云

### 模块流程：

1. **原始点云P0的距离滤波** :  距离过近（0.3m）或者过远（80m）剔除，nan点剔除，注意PCL自带的removeNaNFromCloud()会先判断点云是否是is_dense，若是，会直接跳过后续的处理步骤，可能会删除不干净所有NaN点，所以可以仿造该函数自己写一个处理NaN点的函数；最终得到P1;
2. **点元有序化**：遍历P1的所有点，计算水平角度和仰角，按照仰角得出该点所处的Lidar线束ID,放入一个vector<PointCloud<PointXYZI>>中，该数组的大小和Lidar线束数目相同；该数组标记为P2;
3. **提取特征**：遍历P3中的点，计算每个点在所处的线束上的曲率；对每条线束上的点的曲率进行排序，按曲率从大到小的规则寻找到一定数量（2）的点的索引，做为corner特征，继续往下找找到一定数量（20）的less corner点；反之找到flat点，剩下的点作为less flat点；最终输出四种曲率范围对应的4个特征点云，并发布给Lidar_odom节点用于特征匹配；

### 一些细节：

 * 每条线都按照６部分来提取特征

 * less sharp是包含sharp的点的，sharp点被标记为２，less sharp 被标记为１，

 * 被标记为corner的点，若周围的１０个点的曲率没有超过设定的阈值，要被标记为选中状态

 * ４个flat的点，被标记为－１

 * 所有标记为-1或者０的点，都被加入到less_flat 中

 * 0.1 是sharp和flat的分界点

 * less_flat的点被降采样器降采样

   

### 待改进：

